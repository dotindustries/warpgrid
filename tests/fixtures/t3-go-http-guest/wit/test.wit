package warpgrid:test@0.1.0;

/// Test world for T3 Go HTTP + Postgres integration test.
///
/// Guest component imports the database-proxy shim and exports test functions
/// that simulate what the Go handler would do:
/// - Connect to Postgres through the proxy
/// - Perform startup handshake
/// - Execute SELECT to list users
/// - Execute INSERT to add a user
/// - Handle errors (malformed queries, connection failures)
/// - Close the connection
world t3-go-http-test {
    import warpgrid:shim/database-proxy@0.1.0;

    /// Connect to Postgres, perform startup handshake, return handle as string.
    export test-db-connect: func(host: string, port: u16, database: string, user: string) -> result<string, string>;

    /// Send a SELECT query and return raw response bytes.
    export test-db-query: func(handle-str: string, sql: string) -> result<list<u8>, string>;

    /// Execute an INSERT and return raw response bytes.
    export test-db-insert: func(handle-str: string, name: string, email: string) -> result<list<u8>, string>;

    /// Close a database connection.
    export test-db-close: func(handle-str: string) -> result<string, string>;

    /// Full lifecycle: connect, handshake, SELECT users, close.
    /// Returns the query response bytes.
    export test-full-lifecycle: func(host: string, port: u16, database: string, user: string) -> result<list<u8>, string>;

    /// Full POST lifecycle: connect, handshake, INSERT user, close.
    /// Returns the insert response bytes.
    export test-insert-lifecycle: func(host: string, port: u16, database: string, user: string, name: string, email: string) -> result<list<u8>, string>;
}
