{% extends "base.html" %}

{% block title %}Rollouts â€” WarpGrid{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-8">
  <div>
    <h1 class="text-2xl font-display font-bold text-slate-100 tracking-tight">Rollouts</h1>
    <p class="text-sm text-slate-500 mt-1 font-display">{{ active_rollouts.len() }} active, {{ completed_rollouts.len() }} completed</p>
  </div>
</div>

<!-- Active Rollouts -->
{% if !active_rollouts.is_empty() %}
<div class="mb-8">
  <h2 class="text-xs font-medium uppercase tracking-wider text-slate-500 mb-4">Active</h2>
  <div id="rollout-cards" class="opacity-0 animate-slide-up" hx-get="/dashboard/_rollout_cards" hx-trigger="every 3s" hx-swap="innerHTML">
    {% include "_partials/rollout_cards.html" %}
  </div>
</div>
{% endif %}

<!-- Completed / Rolled-back -->
{% if !completed_rollouts.is_empty() %}
<div>
  <h2 class="text-xs font-medium uppercase tracking-wider text-slate-500 mb-4">History</h2>
  <div class="bg-grid-850 border border-grid-700/30 rounded-xl overflow-hidden">
    <table class="w-full text-sm">
      <thead>
        <tr class="border-b border-grid-700/30 text-left">
          <th class="px-4 py-3 text-xs font-medium uppercase tracking-wider text-slate-500">Deployment</th>
          <th class="px-4 py-3 text-xs font-medium uppercase tracking-wider text-slate-500">Strategy</th>
          <th class="px-4 py-3 text-xs font-medium uppercase tracking-wider text-slate-500">Status</th>
          <th class="px-4 py-3 text-xs font-medium uppercase tracking-wider text-slate-500">Version</th>
        </tr>
      </thead>
      <tbody>
        {% for r in completed_rollouts %}
        <tr class="border-b border-grid-800/60 row-hover transition-colors">
          <td class="px-4 py-3">
            <a href="/dashboard/deployments/{{ r.deployment_id }}" class="text-grid-accent hover:text-grid-accent/80 font-mono transition-colors">{{ r.deployment_id }}</a>
          </td>
          <td class="px-4 py-3">
            <span class="px-2.5 py-0.5 rounded-md text-xs font-mono {{ r.strategy_badge_color }}">{{ r.strategy_display }}</span>
          </td>
          <td class="px-4 py-3 font-mono {{ r.phase_color }}">{{ r.phase_display }}</td>
          <td class="px-4 py-3 font-mono text-slate-400">
            <span class="text-slate-500">{{ r.old_version }}</span>
            <svg class="w-3.5 h-3.5 inline-block mx-1.5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>
            <span class="text-slate-300">{{ r.new_version }}</span>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
{% if active_rollouts.is_empty() %}
<div class="bg-grid-850 border border-grid-700/30 border-dashed rounded-xl p-16 text-center">
  <svg class="w-16 h-16 mx-auto text-grid-700 mb-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
  <p class="text-lg text-slate-300 font-display font-semibold mb-2">No rollouts</p>
  <p class="text-sm text-slate-500 mb-4">Initiate a rollout from any deployment's detail page.</p>
  <a href="/dashboard/deployments" class="inline-block text-sm font-medium text-grid-accent hover:text-grid-accent/80 transition-colors">View Deployments &rarr;</a>
</div>
{% endif %}
{% endif %}
{% endblock %}
